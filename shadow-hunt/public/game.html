<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>POLISI MALING â€“ ARENA</title>

  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/game.css" />

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      touch-action: none;
      user-select: none;
      font-family: 'Courier New', Courier, monospace;
    }
    canvas { display: block; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

  <!-- ORIENTATION LOCK -->
  <div id="orientation-lock" class="hidden">
    <h2 class="pixel-text">PLEASE ROTATE DEVICE</h2>
  </div>

  <!-- LOBBY -->
  <div id="lobby-ui">
    <div class="pixel-text" style="font-size:10px;opacity:.5;">ROOM</div>
    <div class="room-code" id="display-room-id">...</div>
    <div class="status-text" id="status-text">INITIALIZING...</div>
  </div>

  <!-- LOADING -->
  <div id="loading">LOADING ENGINE...</div>

  <!-- GAME CANVAS -->
  <canvas id="game"></canvas>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- CANVAS BOOTSTRAP -->
  <script>
    (function () {
      const canvas = document.getElementById('game');
      const ctx = canvas.getContext('2d');

      function resize() {
        const dpr = window.devicePixelRatio || 1;
        canvas.width = window.innerWidth * dpr;
        canvas.height = window.innerHeight * dpr;
        canvas.style.width = window.innerWidth + 'px';
        canvas.style.height = window.innerHeight + 'px';
      }

      window.addEventListener('resize', resize);
      resize();

      window.__GAME__ = {
        canvas,
        ctx,
        ready() {
          document.getElementById('loading')?.classList.add('hidden');
          document.getElementById('lobby-ui')?.classList.add('hidden');
        }
      };
    })();
  </script>

  <!-- CORE CONFIG -->
  <script src="js/core/config.js"></script>

  <!-- STATE & PLAYER -->
  <script src="js/player/player.js"></script>
  <script src="js/core/state.js"></script>

  <!-- INPUT -->
  <script src="js/input/keyboard.js"></script>
  <script src="js/input/touch.js"></script>
  <script src="js/input/inputManager.js"></script>

  <!-- MAP -->
  <script src="js/map/maps.js"></script>
  <script src="js/map/mapManager.js"></script>
  <script src="js/map/mapLoader.js"></script>

  <!-- PLAYER LOGIC -->
  <script src="js/player/collision.js"></script>
  <script src="js/player/movement.js"></script>

  <!-- GAME SYSTEM -->
  <script src="js/core/stealthManager.js"></script>
  <script src="js/core/roundManager.js"></script>
  <script src="js/ai/botManager.js"></script>

  <!-- RENDER -->
  <script src="js/render/camera.js"></script>
  <script src="js/render/spriteRenderer.js"></script>
  <script src="js/render/fog.js"></script>
  <script src="js/ui/hud.js"></script>
  <script src="js/render/renderer.js"></script>

  <!-- NETWORK & GAME LOOP -->
  <script src="js/core/networkManager.js"></script>
  <script src="js/core/game.js"></script>

  <!-- MODE INIT (HARUS SEBELUM GAME LOOP AKTIF) -->
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      const mode = params.get('mode');
      const room = params.get('room');
      const role = params.get('role');

      const uiRoom = document.getElementById('display-room-id');
      const uiStatus = document.getElementById('status-text');

      if (!window.NETWORK) {
        alert('NETWORK FAILED TO LOAD');
        return;
      }

      if (mode === 'single') {
        uiRoom.textContent = 'OFFLINE';
        uiStatus.textContent = 'VS BOT';
        NETWORK.initOffline();
        return;
      }

      if (mode === 'online' && room && role) {
        uiRoom.textContent = room;
        uiStatus.textContent =
          role === 'host' ? 'WAITING PLAYER...' : 'CONNECTING...';
        NETWORK.init(room, role);
        return;
      }

      location.href = 'index.html';
    })();
  </script>

</body>
</html>
